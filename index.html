<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Сборка ПК</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #121212;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #bb86fc;
            margin-bottom: 30px;
            font-size: 1.8em;
        }
        .step {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }
        .question {
            font-weight: 600;
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #03dac6;
        }
        .options {
            display: grid;
            gap: 12px;
        }
        button {
            padding: 16px 20px;
            background: #3700b3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover {
            background: #6200ee;
        }
        .back-btn {
            background: #333;
            margin-top: 15px;
        }
        #summary {
            display: none;
            background: #1e1e1e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        .summary-title {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            color: #03dac6;
            margin-bottom: 24px;
        }
        .component {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #333;
            font-size: 1.1em;
        }
        .total {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin-top: 30px;
            color: #bb86fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Сборка ПК</h1>
        <div id="steps"></div>
        <div id="summary"></div>
    </div>

    <script>
        let tg;
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            tg = Telegram.WebApp;
            tg.ready();
            tg.expand();
        } else {
            tg = { sendData: (d) => console.log("Отправлено:", d) };
        }

        const PRICES = { /* Вставьте весь ваш словарь PRICES сюда */ };

        const labels = {
            cpu: "Процессор",
            cpu_series: "Серия процессора",
            cpu_generation: "Поколение процессора",
            cpu_model: "Модель процессора",
            gpu_brand: "Бренд видеокарты",
            gpu_generation: "Поколение видеокарты",
            gpu_model: "Модель видеокарты",
            ram_size: "Оперативная память",
            ssd_size: "SSD",
            budget: "Бюджет"
        };

        const answers = {};
        let currentIndex = 0;

        const steps = [
            { id: 'cpu', question: 'Процессор: AMD или Intel?', options: ['AMD', 'Intel'] },
            { id: 'cpu_series', question: (a) => a.cpu === 'AMD' ? 'Выберите серию AMD Ryzen:' : 'Выберите серию Intel:', options: (a) => a.cpu === 'AMD' ? ['5 серия', '7 серия', '9 серия'] : ['i-серия', 'ultra-серия'] },
            { id: 'cpu_generation', question: 'Выберите поколение:', options: ['5 серия', '7 серия', '9 серия'], condition: (a) => a.cpu === 'Intel' },
            { id: 'cpu_model', question: 'Выберите модель процессора:', options: (a) => { /* полная логика как раньше */ } },
            { id: 'gpu_brand', question: 'Видеокарта: Nvidia, Radeon или Intel?', options: ['Nvidia', 'Radeon', 'Intel'] },
            { id: 'gpu_generation', question: (a) => a.gpu_brand === 'Nvidia' ? 'Поколение Nvidia:' : 'Поколение Radeon:', options: (a) => a.gpu_brand === 'Nvidia' ? ['30 серии', '40 серии', '50 серии'] : ['6000 серии', '7000 серии', '9000 серии'], condition: (a) => a.gpu_brand !== 'Intel' },
            { id: 'gpu_model', question: 'Модель видеокарты:', options: (a) => { /* полная логика как раньше */ } },
            { id: 'ram_size', question: 'Сколько оперативной памяти нужно?', options: ['16 ГБ', '32 ГБ', '64 ГБ', '128 ГБ'] },
            { id: 'ssd_size', question: 'Какой объём SSD?', options: ['1 ТБ', '2 ТБ', '3 ТБ', '4 ТБ', '5 ТБ', '6 ТБ'] },
            { id: 'budget', question: () => `Ваш бюджет? (текущая сборка ≈ ${Math.round(calculateTotal()/1000)}к ₽)`, options: () => { /* логика бюджета */ } }
        ];

        function getCurrentStep() {
            let i = currentIndex;
            while (i < steps.length) {
                const step = steps[i];
                if (!step.condition || step.condition(answers)) return {step, index: i};
                i++;
            }
            return null;
        }

        function renderStep() {
            const container = document.getElementById('steps');
            container.innerHTML = '';

            const curr = getCurrentStep();
            if (!curr) {
                showSummary();
                return;
            }

            const step = curr.step;
            const question = typeof step.question === 'function' ? step.question(answers) : step.question;
            const options = typeof step.options === 'function' ? step.options(answers) : step.options;

            const stepDiv = document.createElement('div');
            stepDiv.className = 'step';
            stepDiv.innerHTML = `<div class="question">${question}</div><div class="options"></div>`;

            const optionsDiv = stepDiv.querySelector('.options');
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.onclick = () => {
                    answers[step.id] = opt;
                    currentIndex = curr.index + 1;
                    renderStep();
                };
                optionsDiv.appendChild(btn);
            });

            // Кнопка Назад
            if (currentIndex > 0) {
                const backBtn = document.createElement('button');
                backBtn.className = 'back-btn';
                backBtn.textContent = '← Назад';
                backBtn.onclick = () => {
                    currentIndex--;
                    renderStep();
                };
                stepDiv.appendChild(backBtn);
            }

            container.appendChild(stepDiv);
        }

        function calculateTotal() {
            let total = 0;
            ['cpu_model', 'gpu_model', 'ram_size', 'ssd_size'].forEach(k => {
                if (answers[k] && PRICES[answers[k]]) total += PRICES[answers[k]];
            });
            return total;
        }

        function showSummary() {
            document.getElementById('steps').style.display = 'none';
            const summary = document.getElementById('summary');
            summary.style.display = 'block';

            let html = '<div class="summary-title">Ваша сборка готова!</div>';
            html += '<div class="options">';
            for (let key in answers) {
                const label = labels[key] || key;
                const value = answers[key];
                const price = PRICES[value] || 0;
                html += `<div class="component"><span>${label}:</span><span>${value} ${price ? '— ' + price.toLocaleString() + ' ₽' : ''}</span></div>`;
            }
            html += '</div>';
            html += `<div class="total">Итого: ${calculateTotal().toLocaleString()} ₽</div>`;

            summary.innerHTML = html;

            // Основная кнопка Telegram
            tg.MainButton.setText('Отправить сборку');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                tg.sendData(JSON.stringify(answers));
                setTimeout(() => tg.close(), 500);
            });
        }

        // Запуск
        renderStep();
    </script>
</body>
</html>

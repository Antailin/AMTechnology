<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–±–æ—Ä–∫–∞ –ü–ö</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #121212;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #bb86fc;
            margin-bottom: 30px;
            font-size: 1.8em;
        }
        .step {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }
        .question {
            font-weight: 600;
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #03dac6;
        }
        .options {
            display: grid;
            gap: 12px;
        }
        button {
            padding: 16px 20px;
            background: #3700b3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover {
            background: #6200ee;
        }
        .back-btn {
            background: #333;
            margin-top: 15px;
        }
        #summary {
            display: none;
        }
        .summary-title {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            color: #03dac6;
            margin-bottom: 24px;
        }
        .component {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #333;
            font-size: 1.1em;
        }
        .total {
            font-size: 1.9em;
            font-weight: bold;
            text-align: center;
            margin-top: 30px;
            color: #bb86fc;
        }
        #status {
            text-align: center;
            margin-top: 25px;
            font-size: 1.2em;
            color: #4ade80;
        }
        .error {
            color: #ff5555 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–°–±–æ—Ä–∫–∞ –ü–ö</h1>
        <div id="steps"></div>
        <div id="summary"></div>
        <div id="status"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;

        if (tg && tg.initData) {
            tg.ready();
            tg.expand();
            tg.enableClosingConfirmation();
        }

        const PRICES = {
            'AMD Ryzen 5 8500G': 19000,
            'AMD Ryzen 5 8600G': 23000,
            'AMD Ryzen 7 7700': 23500,
            'AMD Ryzen 7 7700X': 28000,
            'AMD Ryzen 7 7800X3D': 35000,
            'AMD Ryzen 7 8700G': 27000,
            'AMD Ryzen 7 9700X': 29000,
            'AMD Ryzen 7 9800X3D': 49000,
            'AMD Ryzen 9 7900X': 39000,
            'AMD Ryzen 9 7900X3D': 72000,
            'AMD Ryzen 9 7950X': 58000,
            'AMD Ryzen 9 7950X3D': 70000,
            'AMD Ryzen 9 9900X': 41000,
            'AMD Ryzen 9 9900X3D': 59000,
            'AMD Ryzen 9 9950X': 52000,
            'AMD Ryzen 9 9950X3D': 69000,
            'intel i5 12400': 12000,
            'intel i5 14400': 21000,
            'intel i5 14400f': 18000,
            'intel i5 14600kf': 20000,
            'intel i7 13700': 28000,
            'intel i7 14700F': 28000,
            'intel i7 14700': 30000,
            'intel i9 14900': 40000,
            'intel i9 14900kf': 41000,
            'intel i9 14900k': 43000,
            'Intel Core Ultra 5 225F OEM': 15000,
            'Intel Core Ultra 5 225 OEM': 15500,
            'Intel Core Ultra 5 245KF OEM': 19000,
            'Intel Core Ultra 5 245K OEM': 22000,
            'Intel Core Ultra 7 265KF OEM': 26000,
            'Intel Core Ultra 7 265K OEM': 27000,
            'Intel Core Ultra 9 285K oem': 49900,
            '3060': 24000,
            '3060ti': 30000,
            '3070': 35000,
            '3070ti': 40000,
            '3080': 45000,
            '3080ti': 60000,
            '3090': 90000,
            '3090ti': 120000,
            '4060': 35000,
            '4060ti(8gb)': 40000,
            '4060ti(16gb)': 50000,
            '4070': 60000,
            '4070 super': 60000,
            '4070ti': 69000,
            '4070ti super': 89000,
            '4080': 85000,
            '4080 super': 127000,
            '4090': 149000,
            '5060': 32000,
            '5060ti(8gb)': 40000,
            '5060ti(16gb)': 50000,
            '5070': 65000,
            '5070ti': 95000,
            '5080': 140000,
            '5090': 329000,
            'Radeon RX 6750 GRE 10 GB': 35000,
            'Radeon RX 6750 GRE 12 GB': 40000,
            'Radeon RX 7400': 45000,
            'Radeon RX 7600': 29000,
            'Radeon RX 7600 XT': 45000,
            'Radeon RX 7700 XT': 40000,
            'Radeon RX 7800 XT': 45000,
            'Radeon RX 7900 GRE': 45000,
            'Radeon RX 7650 GRE': 42000,
            'Radeon RX 9060': 42000,
            'Radeon RX 9060 XT 8 GB': 40000,
            'Radeon RX 9060 XT 16 GB': 60000,
            'Radeon RX 9070': 50000,
            'Radeon RX 9070 GRE': 50000,
            'Radeon RX 9070 XT': 55000,
            'Arc B580': 39000,
            'Arc B570': 35000,
            '16 –ì–ë': 18000,
            '32 –ì–ë': 35000,
            '64 –ì–ë': 80000,
            '128 –ì–ë': 156000,
            '1 –¢–ë': 20000,
            '2 –¢–ë': 40000,
            '3 –¢–ë': 60000,
            '4 –¢–ë': 80000,
            '5 –¢–ë': 100000,
            '6 –¢–ë': 120000,
        };

        const labels = {
            cpu: "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä",
            cpu_series: "–°–µ—Ä–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞",
            cpu_generation: "–ü–æ–∫–æ–ª–µ–Ω–∏–µ",
            cpu_model: "–ú–æ–¥–µ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞",
            gpu_brand: "–ë—Ä–µ–Ω–¥ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã",
            gpu_generation: "–ü–æ–∫–æ–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã",
            gpu_model: "–ú–æ–¥–µ–ª—å –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã",
            ram_size: "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å",
            ssd_size: "SSD",
            budget: "–ë—é–¥–∂–µ—Ç"
        };

        const answers = {};
        const history = [];
        let currentStep = 'cpu';

        function getOptions() {
            switch (currentStep) {
                case 'cpu':
                    return ['AMD', 'Intel'];

                case 'cpu_series':
                    // AMD: 5/7/9 —Å–µ—Ä–∏—è | Intel: i-—Å–µ—Ä–∏—è / ultra-—Å–µ—Ä–∏—è
                    return answers.cpu === 'AMD'
                        ? ['5 —Å–µ—Ä–∏—è', '7 —Å–µ—Ä–∏—è', '9 —Å–µ—Ä–∏—è']
                        : ['i-—Å–µ—Ä–∏—è', 'ultra-—Å–µ—Ä–∏—è'];

                case 'cpu_generation':
                    // –¢–æ–ª—å–∫–æ –¥–ª—è Intel ‚Äî –≤—ã–±–æ—Ä –ø–æ–∫–æ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –º–æ–¥–µ–ª—å—é
                    return ['5 —Å–µ—Ä–∏—è', '7 —Å–µ—Ä–∏—è', '9 —Å–µ—Ä–∏—è'];

                case 'cpu_model':
                    if (answers.cpu === 'AMD') {
                        const m = {
                            '5 —Å–µ—Ä–∏—è': ['AMD Ryzen 5 8500G', 'AMD Ryzen 5 8600G'],
                            '7 —Å–µ—Ä–∏—è': ['AMD Ryzen 7 7700', 'AMD Ryzen 7 7700X', 'AMD Ryzen 7 7800X3D', 'AMD Ryzen 7 8700G', 'AMD Ryzen 7 9700X', 'AMD Ryzen 7 9800X3D'],
                            '9 —Å–µ—Ä–∏—è': ['AMD Ryzen 9 7900X', 'AMD Ryzen 9 7900X3D', 'AMD Ryzen 9 7950X', 'AMD Ryzen 9 7950X3D', 'AMD Ryzen 9 9900X', 'AMD Ryzen 9 9900X3D', 'AMD Ryzen 9 9950X', 'AMD Ryzen 9 9950X3D']
                        };
                        return m[answers.cpu_series] || [];
                    } else {
                        const gen = answers.cpu_generation;
                        const m = answers.cpu_series === 'i-—Å–µ—Ä–∏—è' ? {
                            '5 —Å–µ—Ä–∏—è': ['intel i5 12400', 'intel i5 14400', 'intel i5 14400f', 'intel i5 14600kf'],
                            '7 —Å–µ—Ä–∏—è': ['intel i7 13700', 'intel i7 14700F', 'intel i7 14700'],
                            '9 —Å–µ—Ä–∏—è': ['intel i9 14900', 'intel i9 14900kf', 'intel i9 14900k']
                        } : {
                            '5 —Å–µ—Ä–∏—è': ['Intel Core Ultra 5 225F OEM', 'Intel Core Ultra 5 225 OEM', 'Intel Core Ultra 5 245KF OEM', 'Intel Core Ultra 5 245K OEM'],
                            '7 —Å–µ—Ä–∏—è': ['Intel Core Ultra 7 265KF OEM', 'Intel Core Ultra 7 265K OEM'],
                            '9 —Å–µ—Ä–∏—è': ['Intel Core Ultra 9 285K oem']
                        };
                        return m[gen] || [];
                    }

                case 'gpu_brand':
                    return ['Nvidia', 'Radeon', 'Intel'];

                case 'gpu_generation':
                    return answers.gpu_brand === 'Nvidia'
                        ? ['30 —Å–µ—Ä–∏–∏', '40 —Å–µ—Ä–∏–∏', '50 —Å–µ—Ä–∏–∏']
                        : ['6000 —Å–µ—Ä–∏–∏', '7000 —Å–µ—Ä–∏–∏', '9000 —Å–µ—Ä–∏–∏'];

                case 'gpu_model':
                    if (answers.gpu_brand === 'Intel') return ['Arc B580', 'Arc B570'];
                    const gen = answers.gpu_generation;
                    if (answers.gpu_brand === 'Nvidia') {
                        const m = {
                            '30 —Å–µ—Ä–∏–∏': ['3060', '3060ti', '3070', '3070ti', '3080', '3080ti', '3090', '3090ti'],
                            '40 —Å–µ—Ä–∏–∏': ['4060', '4060ti(8gb)', '4060ti(16gb)', '4070', '4070 super', '4070ti', '4070ti super', '4080', '4080 super', '4090'],
                            '50 —Å–µ—Ä–∏–∏': ['5060', '5060ti(8gb)', '5060ti(16gb)', '5070', '5070ti', '5080', '5090']
                        };
                        return m[gen] || [];
                    } else {
                        const m = {
                            '6000 —Å–µ—Ä–∏–∏': ['Radeon RX 6750 GRE 10 GB', 'Radeon RX 6750 GRE 12 GB'],
                            '7000 —Å–µ—Ä–∏–∏': ['Radeon RX 7400', 'Radeon RX 7600', 'Radeon RX 7600 XT', 'Radeon RX 7700 XT', 'Radeon RX 7800 XT', 'Radeon RX 7900 GRE'],
                            '9000 —Å–µ—Ä–∏–∏': ['Radeon RX 7650 GRE', 'Radeon RX 9060', 'Radeon RX 9060 XT', 'Radeon RX 9060 XT 8 GB', 'Radeon RX 9060 XT 16 GB', 'Radeon RX 9070', 'Radeon RX 9070 GRE', 'Radeon RX 9070 XT']
                        };
                        return m[gen] || [];
                    }

                case 'ram_size':
                    return ['16 –ì–ë', '32 –ì–ë', '64 –ì–ë', '128 –ì–ë'];

                case 'ssd_size':
                    return ['1 –¢–ë', '2 –¢–ë', '3 –¢–ë', '4 –¢–ë', '5 –¢–ë', '6 –¢–ë'];

                case 'budget': {
                    const total = calculateTotal();
                    let opts = [];
                    if (total <= 100000) {
                        opts = ['–¥–æ 100–∫', '–¥–æ 200–∫', '–¥–æ 300–∫', '–¥–æ 400–∫', '–¥–æ 500–∫', '500+–∫'];
                    } else {
                        [200000, 300000, 400000, 500000].forEach(b => {
                            if (b > total) opts.push(`–¥–æ ${b/1000}–∫`);
                        });
                        const lower = total - 50000;
                        if (lower >= 100000) opts.push(`–¥–æ ${Math.round(lower/1000)}–∫`);
                        opts.sort((a, b) => parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1]));
                        opts.push('500+–∫');
                    }
                    return opts;
                }
            }
            return [];
        }

        function getNextStep() {
            switch (currentStep) {
                case 'cpu':         return 'cpu_series';
                case 'cpu_series':
                    // AMD ‚Üí —Å—Ä–∞–∑—É –∫ –º–æ–¥–µ–ª–∏, Intel ‚Üí —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–æ–ª–µ–Ω–∏–µ
                    return answers.cpu === 'AMD' ? 'cpu_model' : 'cpu_generation';
                case 'cpu_generation': return 'cpu_model';
                case 'cpu_model':   return 'gpu_brand';
                case 'gpu_brand':
                    // Intel GPU ‚Üí —Å—Ä–∞–∑—É –∫ –º–æ–¥–µ–ª–∏, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –ø–æ–∫–æ–ª–µ–Ω–∏–µ
                    return answers.gpu_brand === 'Intel' ? 'gpu_model' : 'gpu_generation';
                case 'gpu_generation': return 'gpu_model';
                case 'gpu_model':   return 'ram_size';
                case 'ram_size':    return 'ssd_size';
                case 'ssd_size':    return 'budget';
                case 'budget':      return null;
            }
            return null;
        }

        function renderStep() {
            const container = document.getElementById('steps');
            container.innerHTML = '';

            const question = {
                cpu: '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: AMD –∏–ª–∏ Intel?',
                cpu_series: answers.cpu === 'AMD' ? '–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é AMD Ryzen:' : '–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–∏—é Intel:',
                cpu_generation: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ:',
                cpu_model: '–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:',
                gpu_brand: '–í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞: Nvidia, Radeon –∏–ª–∏ Intel?',
                gpu_generation: answers.gpu_brand === 'Nvidia' ? '–ü–æ–∫–æ–ª–µ–Ω–∏–µ Nvidia:' : '–ü–æ–∫–æ–ª–µ–Ω–∏–µ Radeon:',
                gpu_model: '–ú–æ–¥–µ–ª—å –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã:',
                ram_size: '–°–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –Ω—É–∂–Ω–æ?',
                ssd_size: '–ö–∞–∫–æ–π –æ–±—ä—ë–º SSD?',
                budget: `–í–∞—à –±—é–¥–∂–µ—Ç? (—Ç–µ–∫—É—â–∞—è —Å–±–æ—Ä–∫–∞ ‚âà ${Math.round(calculateTotal()/1000)}–∫ ‚ÇΩ)`
            }[currentStep];

            const options = getOptions();

            const stepDiv = document.createElement('div');
            stepDiv.className = 'step';
            stepDiv.innerHTML = `<div class="question">${question}</div><div class="options"></div>`;

            const optionsDiv = stepDiv.querySelector('.options');
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.onclick = () => {
                    answers[currentStep] = opt;
                    history.push(currentStep);

                    const next = getNextStep();
                    if (next) {
                        currentStep = next;
                        renderStep();
                    } else {
                        showSummary();
                    }
                };
                optionsDiv.appendChild(btn);
            });

            if (history.length > 0) {
                const backBtn = document.createElement('button');
                backBtn.className = 'back-btn';
                backBtn.textContent = '‚Üê –ù–∞–∑–∞–¥';
                backBtn.onclick = () => {
                    currentStep = history.pop();
                    renderStep();
                };
                stepDiv.appendChild(backBtn);
            }

            container.appendChild(stepDiv);
        }

        function calculateTotal() {
            let total = 0;
            ['cpu_model', 'gpu_model', 'ram_size', 'ssd_size'].forEach(k => {
                if (answers[k] && PRICES[answers[k]]) total += PRICES[answers[k]];
            });
            return total;
        }

        function showSummary() {
            document.getElementById('steps').style.display = 'none';
            const summary = document.getElementById('summary');
            summary.style.display = 'block';

            let html = '<div class="summary-title">–í–∞—à–∞ —Å–±–æ—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞!</div>';
            html += '<div class="options">';
            for (let key in answers) {
                html += `<div class="component"><span>${labels[key] || key}:</span><span>${answers[key]}</span></div>`;
            }
            html += '</div>';
            html += `<div class="total">–ò—Ç–æ–≥–æ: ${calculateTotal().toLocaleString()} ‚ÇΩ</div>`;
            summary.innerHTML = html;

            const data = JSON.stringify(answers);
            console.log("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º:", data);

            tg.MainButton.setText('üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–±–æ—Ä–∫—É');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                tg.MainButton.disable();
                tg.MainButton.showProgress(true);
                tg.sendData(data);
            });
        }

        // –ó–∞–ø—É—Å–∫
        renderStep();
    </script>
</body>
</html>

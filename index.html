<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Сборка ПК</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #121212;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #bb86fc;
            margin-bottom: 30px;
            font-size: 1.8em;
        }
        .step {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            margin-bottom: 20px;
        }
        .question {
            font-weight: 600;
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #03dac6;
        }
        .options {
            display: grid;
            gap: 12px;
        }
        button {
            padding: 16px 20px;
            background: #3700b3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }
        button:hover {
            background: #6200ee;
        }
        .back-btn {
            background: #333;
            margin-top: 15px;
        }
        #summary {
            display: none;
        }
        .summary-title {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            color: #03dac6;
            margin-bottom: 24px;
        }
        .component {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #333;
            font-size: 1.1em;
        }
        .total {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin-top: 30px;
            color: #bb86fc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Сборка ПК</h1>
        <div id="steps"></div>
        <div id="summary"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp || {};
        tg.ready();
        tg.expand();

        const PRICES = { /* Вставьте сюда весь ваш объект PRICES */ };

        const answers = {};
        let currentStep = 'cpu';

        // === ЛОГИКА ПЕРЕХОДОВ ===
        function getNextStep() {
            if (currentStep === 'cpu') return 'cpu_series';
            if (currentStep === 'cpu_series') {
                return answers['cpu'] === 'AMD' ? 'cpu_model' : 'cpu_generation';
            }
            if (currentStep === 'cpu_generation') return 'cpu_model';
            if (currentStep === 'cpu_model') return 'gpu_brand';
            if (currentStep === 'gpu_brand') {
                return answers['gpu_brand'] === 'Intel' ? 'gpu_model' : 'gpu_generation';
            }
            if (currentStep === 'gpu_generation') return 'gpu_model';
            if (currentStep === 'gpu_model') return 'ram_size';
            if (currentStep === 'ram_size') return 'ssd_size';
            if (currentStep === 'ssd_size') return 'budget';
            return null; // конец
        }

        function renderStep() {
            const container = document.getElementById('steps');
            container.innerHTML = '';

            let question = '';
            let options = [];

            switch (currentStep) {
                case 'cpu':
                    question = 'Процессор: AMD или Intel?';
                    options = ['AMD', 'Intel'];
                    break;

                case 'cpu_series':
                    question = answers['cpu'] === 'AMD' ? 'Выберите серию AMD Ryzen:' : 'Выберите серию Intel:';
                    options = answers['cpu'] === 'AMD' ? ['5 серия', '7 серия', '9 серия'] : ['i-серия', 'ultra-серия'];
                    break;

                case 'cpu_generation':
                    question = 'Выберите поколение:';
                    options = ['5 серия', '7 серия', '9 серия'];
                    break;

                case 'cpu_model':
                    question = 'Выберите модель процессора:';
                    if (answers['cpu'] === 'AMD') {
                        const m = {
                            '5 серия': ['AMD Ryzen 5 8500G', 'AMD Ryzen 5 8600G'],
                            '7 серия': ['AMD Ryzen 7 7700', 'AMD Ryzen 7 7700X', 'AMD Ryzen 7 7800X3D', 'AMD Ryzen 7 8700G', 'AMD Ryzen 7 9700X', 'AMD Ryzen 7 9800X3D'],
                            '9 серия': ['AMD Ryzen 9 7900X', 'AMD Ryzen 9 7900X3D', 'AMD Ryzen 9 7950X', 'AMD Ryzen 9 7950X3D', 'AMD Ryzen 9 9900X', 'AMD Ryzen 9 9900X3D', 'AMD Ryzen 9 9950X', 'AMD Ryzen 9 9950X3D']
                        };
                        options = m[answers['cpu_series']] || [];
                    } else {
                        const gen = answers['cpu_generation'];
                        const m = answers['cpu_series'] === 'i-серия' ? {
                            '5 серия': ['intel i5 12400', 'intel i5 14400', 'intel i5 14400f', 'intel i5 14600kf'],
                            '7 серия': ['intel i7 13700', 'intel i7 14700F', 'intel i7 14700'],
                            '9 серия': ['intel i9 14900', 'intel i9 14900kf', 'intel i9 14900k']
                        } : {
                            '5 серия': ['Intel Core Ultra 5 225F OEM', 'Intel Core Ultra 5 225 OEM', 'Intel Core Ultra 5 245KF OEM', 'Intel Core Ultra 5 245K OEM'],
                            '7 серия': ['Intel Core Ultra 7 265KF OEM', 'Intel Core Ultra 7 265K OEM'],
                            '9 серия': ['Intel Core Ultra 9 285K oem']
                        };
                        options = m[gen] || [];
                    }
                    break;

                case 'gpu_brand':
                    question = 'Видеокарта: Nvidia, Radeon или Intel?';
                    options = ['Nvidia', 'Radeon', 'Intel'];
                    break;

                case 'gpu_generation':
                    question = answers['gpu_brand'] === 'Nvidia' ? 'Поколение Nvidia:' : 'Поколение Radeon:';
                    options = answers['gpu_brand'] === 'Nvidia' ? ['30 серии', '40 серии', '50 серии'] : ['6000 серии', '7000 серии', '9000 серии'];
                    break;

                case 'gpu_model':
                    question = 'Модель видеокарты:';
                    if (answers['gpu_brand'] === 'Intel') {
                        options = ['Arc B580', 'Arc B570'];
                    } else {
                        const gen = answers['gpu_generation'];
                        const m = answers['gpu_brand'] === 'Nvidia' ? {
                            '30 серии': ['3060', '3060ti', '3070', '3070ti', '3080', '3080ti', '3090', '3090ti'],
                            '40 серии': ['4060', '4060ti(8gb)', '4060ti(16gb)', '4070', '4070 super', '4070ti', '4070ti super', '4080', '4080 super', '4090'],
                            '50 серии': ['5060', '5060ti(8gb)', '5060ti(16gb)', '5070', '5070ti', '5080', '5090']
                        } : {
                            '6000 серии': ['Radeon RX 6750 GRE 10 GB', 'Radeon RX 6750 GRE 12 GB'],
                            '7000 серии': ['Radeon RX 7400', 'Radeon RX 7600', 'Radeon RX 7600 XT', 'Radeon RX 7700 XT', 'Radeon RX 7800 XT', 'Radeon RX 7900 GRE'],
                            '9000 серии': ['Radeon RX 7650 GRE', 'Radeon RX 9060', 'Radeon RX 9060 XT', 'Radeon RX 9060 XT 8 GB', 'Radeon RX 9060 XT 16 GB', 'Radeon RX 9070', 'Radeon RX 9070 GRE', 'Radeon RX 9070 XT']
                        };
                        options = m[gen] || [];
                    }
                    break;

                case 'ram_size':
                    question = 'Сколько оперативной памяти нужно?';
                    options = ['16 ГБ', '32 ГБ', '64 ГБ', '128 ГБ'];
                    break;

                case 'ssd_size':
                    question = 'Какой объём SSD?';
                    options = ['1 ТБ', '2 ТБ', '3 ТБ', '4 ТБ', '5 ТБ', '6 ТБ'];
                    break;

                case 'budget':
                    const total = calculateTotal();
                    question = `Ваш бюджет? (текущая сборка ≈ ${Math.round(total/1000)}к ₽)`;
                    let budgetOptions = [];
                    if (total <= 100000) {
                        budgetOptions = ['до 100к', 'до 200к', 'до 300к', 'до 400к', 'до 500к', '500+к'];
                    } else {
                        const base = [200000, 300000, 400000, 500000].filter(b => b > total).map(b => `до ${b/1000}к`);
                        const lower = total - 50000;
                        if (lower >= 100000) {
                            const str = `до ${Math.round(lower/1000)}к`;
                            if (!base.includes(str)) base.push(str);
                        }
                        base.sort((a,b) => parseInt(a.split(' ')[1]) - parseInt(b.split(' ')[1]));
                        budgetOptions = base.concat('500+к');
                    }
                    options = budgetOptions;
                    break;
            }

            const stepDiv = document.createElement('div');
            stepDiv.className = 'step';
            stepDiv.innerHTML = `<div class="question">${question}</div><div class="options"></div>`;

            const optionsDiv = stepDiv.querySelector('.options');
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.onclick = () => {
                    answers[currentStep] = opt;
                    const next = getNextStep();
                    if (next) {
                        currentStep = next;
                        renderStep();
                    } else {
                        showSummary();
                    }
                };
                optionsDiv.appendChild(btn);
            });

            // Кнопка Назад
            if (currentStep !== 'cpu') {
                const back = document.createElement('button');
                back.className = 'back-btn';
                back.textContent = '← Назад';
                back.onclick = () => {
                    // Простой возврат назад (можно улучшить)
                    currentStep = 'cpu'; // для простоты возвращаем в начало, или можно сделать историю
                    renderStep();
                };
                stepDiv.appendChild(back);
            }

            container.appendChild(stepDiv);
        }

        function calculateTotal() {
            let total = 0;
            ['cpu_model','gpu_model','ram_size','ssd_size'].forEach(k => {
                if (answers[k] && PRICES[answers[k]]) total += PRICES[answers[k]];
            });
            return total;
        }

        function showSummary() {
            document.getElementById('steps').style.display = 'none';
            const summary = document.getElementById('summary');
            summary.style.display = 'block';

            let html = '<div class="summary-title">Ваша сборка готова!</div>';
            html += '<div class="options">';
            for (let key in answers) {
                const label = labels[key] || key;
                const value = answers[key];
                const price = PRICES[value] || 0;
                html += `<div class="component"><span>${label}:</span><span>${value} ${price ? '— ' + price.toLocaleString() + ' ₽' : ''}</span></div>`;
            }
            html += '</div>';
            html += `<div class="total">Итого: ${calculateTotal().toLocaleString()} ₽</div>`;
            html += '<button id="send-btn">Отправить сборку</button>';

            summary.innerHTML = html;

            document.getElementById('send-btn').onclick = () => {
                tg.sendData(JSON.stringify(answers));
                tg.close();
            };

            tg.MainButton.setText('Отправить сборку');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                tg.sendData(JSON.stringify(answers));
                tg.close();
            });
        }

        // Запуск
        renderStep();
    </script>
</body>
</html>
